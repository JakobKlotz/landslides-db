# Landslide DB Setup

## Initial Postgres Setup

For convenience, use Docker, pull the image and run the container:

```bash
docker pull postgis/postgis
docker run --name landslides-db -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d postgis/postgis
```

Create a database named `landslides`:

```bash
docker exec -ti landslides-db createdb -U postgres landslides
```

## `alembic` setup

Init the folder structure:

```bash
alembic init landslides
```

### Customize files

Create a dedicated `.env` for the database secrets and switch to `env.py`, 
add lines to load the variables. 

### Autogenerate revision

With `alembic` autogenerate the first revision from the `sqlalchemy` models:

```bash
alembic revision --autogenerate -m "db table structure"
```

Navigate to the first revision and ensure that the `postgis` extension is
enabled. Add following at the beginning of `upgrade()`:

```python
op.execute("CREATE EXTENSION IF NOT EXISTS postgis")
```

... and at the end to `downgrade()`:

```python
op.execute("DROP EXTENSION postgis")
```

### Apply revision

```bash
alembic upgrade head
```
